---
创建时间: 2025-05-17 15:37:39
作者: wangxiaoming
tags:
  - MySQL
---

#### 一、`InnoDB` 存储引擎
##### **1. 核心数据结构：B+树**​
- ​**索引组织表（`IOT`）​**​：  
    `InnoDB` 表数据以 ​**聚簇索引（Clustered Index）​**​ 组织，数据按主键顺序存储在 B+树中，叶子节点直接包含完整的行数据。
    - ​**主键索引**​：B+树的键为主键值，叶子节点存储整行数据。
    - ​**二级索引**​：B+树的键为索引字段值，叶子节点存储主键值（需回表查询完整数据）。
- ​**B+树特点**​：
    
    - ​**非叶子节点仅存键值**，不存数据，减少树高，提升查询效率。
    - ​**叶子节点形成链表**，支持高效范围查询（如 `WHERE id > 10 AND id < 20`）。
    - ​**页（Page）结构**​：默认页大小为 `16KB`，存储索引键和指向子页的指针，数据按主键顺序填充。
##### ​**2. 数据存储方式：行存储（Row-Based）​**​
- ​**行格式（Row Format）​**​：
    - ​**COMPACT**​：存储字段长度、NULL标志位和字段值，适合变长字段较少的场景。
    - ​**DYNAMIC**​：变长字段（如 TEXT/BLOB）存储为溢出页指针，减少主行数据体积。
    - ​**COMPRESSED**​：对行数据压缩，节省存储空间（需权衡 CPU 开销）。
- ​**页内数据管理**​：
    - ​**槽（Slots）​**​：页头维护槽位数组，快速定位数据行位置。
    - ​**行溢出处理**​：当行数据超过页剩余空间时，部分字段存储到溢出页。
##### ​**3. 文件组织**​
- ​**表空间（`Tablespace`）​**​：
    - ​**系统表空间**​：默认存储 `InnoDB` 系统表（如 `ibdata1`），包含数据字典、Undo Log 等。
    - ​**独立表空间**​：每个表对应 `.ibd` 文件，存储表数据和索引（需启用 `innodb_file_per_table`）。
- ​**redo Log**​：  
    循环写入的物理日志文件（如 `ib_logfile0`/`ib_logfile1`），记录数据页修改操作，用于崩溃恢复。
##### ​**4. 其他关键机制**​
- ​**`MVCC`（多版本并发控制）​**​：  
    通过 Undo Log 存储历史版本数据，支持非锁定读（如 `SELECT ... FOR SHARE`）。
- ​**自适应哈希索引（`AHI`）​**​：  
    `InnoDB` 自动为热点数据建立内存哈希索引，加速等值查询。
#### 二、`MylSAM`存储引擎
##### **1. 核心数据结构：B树**​
- ​**索引与数据分离**​：
    - ​**主键索引**​：B树存储主键值，叶子节点指向数据行（`.MYD` 文件）。
    - ​**二级索引**​：与主键索引结构相同，叶子节点同样指向数据行。
##### ​**2. 数据存储方式：堆文件（Heap File）​**​
- ​**数据行存储**​：
    - 数据按插入顺序存储在 `.MYD` 文件中，无序。
    - 通过行指针（偏移量）在索引中定位数据。
##### ​**3. 文件组织**​
- ​**表结构文件**​：`.frm` 文件存储表结构定义。
- ​**索引文件**​：`.MYI` 文件存储索引（B树）。
- ​**数据文件**​：`.MYD` 文件存储原始数据。
#### 三、其他引擎
##### **1. Memory 引擎**​
- ​**数据结构**​：哈希表或 B树（取决于 `ROW_FORMAT`）。
- ​**存储方式**​：数据完全存储在内存中，重启后丢失。
##### ​**2. `RocksDB`（`TiKV` 等分布式数据库）​**​
- ​**数据结构**​：`LSM-Tree`（Log-Structured Merge Tree），支持高吞吐写入和范围查询
#### 四、存储结构对比
|**特性**​|​**InnoDB**​|​**MyISAM**​|
|---|---|---|
|​**索引类型**​|聚簇索引 + 二级索引|非聚簇索引|
|​**数据存储**​|行存储，B+树组织|堆文件，B树索引|
|​**事务支持**​|ACID（支持 MVCC）|无|
|​**崩溃恢复**​|依赖 redo Log|无|
|​**适用场景**​|OLTP、高并发写|读密集、静态数据|
#### 五、关节设计思想
1. ​**B+树的优势**​：
    - 平衡树结构保证 O(log n) 查询效率。
    - 叶子节点链表支持高效范围查询。
    - 页结构减少磁盘 I/O 次数（`16KB` 页可存储数百行数据）。
2. ​**行存储 vs 列存储**​：
    - ​**行存储**​：适合 `OLTP`（频繁增删改），减少随机 I/O。
    - ​**列存储**​：适合 `OLAP`（分析型查询），压缩率高，聚合计算快（如 `ClickHouse`）。
3. ​**页的填充因子**​：  
    默认填充约 70% 的页空间，预留空间减少页分裂（如频繁更新时）。
#### 六、总结回答模板
**简洁版**​：  
“InnoDB 使用 B+树作为索引结构，数据按聚簇索引（主键顺序）行存储在 16KB 的页中。主键索引的叶子节点包含完整行数据，二级索引存储主键值用于回表。数据文件通过表空间管理，支持事务和 MVCC。MyISAM 则采用 B树索引和堆文件存储，索引与数据分离。”

​**进阶版**​：  
“`InnoDB` 的底层存储以 B+树为核心，数据按主键顺序组织在聚簇索引中，叶子节点存储行数据并形成链表以支持范围查询。页结构（默认 `16KB`）通过填充因子优化写入效率，行格式（如 DYNAMIC）处理变长字段溢出。`MyISAM` 采用非聚簇索引，索引与数据分离，数据以堆文件存储，适合读密集场景。两者均通过 redo Log 和 Undo Log 保障持久性与事务，但 `InnoDB` 的 `MVCC` 设计更适合高并发 `OLTP`。”