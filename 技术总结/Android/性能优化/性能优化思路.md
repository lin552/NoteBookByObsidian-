#### 一、性能优化类别

##### 场景
- UI绘制
- 应用启动
- 页面跳转
- 事件响应
##### 卡顿原因

1. 绘制卡顿
- 绘制层级深
- 刷新不合理

2. 数据处理卡顿
- 数据在UI线程处理
- 处理占用CPU高，导致主线程拿不到时间片
- 内存增加导致的GC频繁

#### 二、性能分析工具

##### 1）手机端绘制耗时分析 Profile GPU Rendering (Android 4.1 ) 
###### 详情介绍
1. 图形检测工具，能实时反应当时绘制的耗时
2. 横轴时间，纵轴表示每一帧的耗时
3. 随时时间推移，从左到右刷新呈现
4. 提供一个标准的耗时，如果高于标准，表示当前这一帧丢失

###### 使用颜色意义
蓝色：测量绘制时间
红色：执行时间
橙色：处理时间
紫色：将资源转移到渲染线程的时间

###### 现状替代品
小米手机中叫做HWUI 
绿色：GPU绘制耗时

##### 2）TraceView  程序函数调用分析
###### 详情介绍
1. 用来分析函数调用过程的图形化工具
2. 可以分析到应用具体每一个方法的执行时间
3. 通过查看track文件内容来了解调用情况

###### 现状替代品
Android Studio 中的 Profiler工具可以完全替代

##### 3）Systrace UI 系统角度性能分析
###### 详情介绍
1. 从系统的角度来定位问题，通过系统参数的反应情况，看性能
2. 收集（surfaceflinger、WindowsManagerService等）关键模块、服务、View系统信息
3. 功能包括 跟踪系统I/O操作、内核工作队列、CPU负载等
4. 通过Chrome来查看trace.html文件来了解性能情况

###### 现状替代品
Android Studio Profiler 可以完全替代

##### 4）Hierarchy Viewer 布局优化工具

###### 详情介绍
可视化工具用来检查Layout嵌套和绘制时间
功能包括 查看层级 查看View耗时 

###### 现状替代品
Android Studio Layout Inspector

##### 5）Android Lint 代码检查工具

###### 详情介绍
- 通过代码扫描发现潜在代码问题
- 扫描层级过深 TooDeepLayout 超过10层会警告
- 扫描控件太多 TooManyVIews 默认超过80个控件会提示问题

#### 三、布局优化方法
##### 1）较少层级
1. 合理使用布局，减少层级（比如使用约束布局）
2. 使用Merge标签，减少层级
3. 使用Compose UI 框架，走出层级框架
##### 2）提升显示速度
1. 使用ViewStub加载布局
2. 简化控件属性，提高解析速度
3. 宽高等尽量固定值，尽量减少wrap_content
##### 3）布局复用
1. 使用include标签
2. Compose UI 合理定义Compose 函数便于复用

#### 四、避免过度绘制
过度绘制：屏幕中的某个像素点在同一帧的时间被绘制了多次

###### 1）过度绘制原因
1. XML布局，控件有重叠且都有设置背景
2. View自绘，View.OnDraw里同一个区域被绘制多次

##### 2）过度绘制检测工具
- 无色：没有过度绘制
- 蓝色：每个像素多绘制了1次
- 绿色：每个像素多绘制2次
- 淡红：每个像素多绘制3次，区域不超过屏幕1/4可以接受
- 深红：每个像素多绘制4次或者更多。影响性能需要优化

##### 3）避免过度绘制
1. 移除XML中非必需的背景，根据条件设置
2. 移除Window默认背景
3. 按需展示占位背景图片

##### 4）自定义View优化
通过canvas.clipRect()来指定区域进行绘制，其他矩形外的区域会被忽略
使用canvas.quickreject()判断是否没和某个矩形相交