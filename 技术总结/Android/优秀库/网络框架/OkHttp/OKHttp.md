---
创建时间: 2025-04-15 22:34:29
作者: wangxiaoming
tags:
  - OKHttp
  - Android
  - 网络
---
#### 一、`OKHttp`概述
- ​**定义**​：  
    `OKHttp` 是 Square 公司开源的 ​**HTTP 客户端库**，支持 Android 和 Java 应用，以高效、简洁的 API 著称，被广泛用于网络请求、文件上传下载等场景。
- ​**核心优势**​：
    - ​**高性能**​：基于 `NIO` 和 `Okio` 库，支持 HTTP/2、`WebSocket` 协议，减少网络延迟。
    - ​**连接池复用**​：复用 `TCP` 连接，降低握手开销。
    - ​**智能缓存**​：自动处理响应缓存，减少重复请求。
    - ​**透明压缩**​：支持 `GZIP` 压缩，减少数据传输量。
    - ​**生命周期管理**​：自动绑定请求与线程，避免内存泄漏。

#### 二、核心功能与使用
##### 1）基本用法
```kotlin
todo
```
##### 2）高级用法


#### 三、原理与机制
##### 1）请求处理流程
1. ​**创建请求**​：通过 `Request.Builder` 构建请求对象。
2. ​**责任链处理**​：通过拦截器链（如重试、缓存、连接拦截器）处理请求。
3. ​**连接复用**​：从连接池获取可用连接，避免重复建立 `TCP` 连接。
4. ​**数据传输**​：使用 `Okio` 库进行高效读写。
5. ​**响应解析**​：自动解码 `GZIP` 压缩数据，返回 `Response` 对象。
##### 2）关键设计模式
- ​**责任链模式**​：拦截器按顺序处理请求和响应。
- ​**单例模式**​：`OkHttpClient` 默认全局唯一实例。
- ​**工厂模式**​：`Call` 接口的实现类 `RealCall` 由工厂创建。

##### 3）线程模型
- **Dispatcher**​：管理异步请求的线程池，控制并发数（默认最大 64 请求）。
- ​**同步/异步调用**​：`execute()` 阻塞当前线程，`enqueue()` 回调处理结果。

#### 四、优化策略
##### 1）性能优化


##### 2）安全优化


##### 3）弱网处理


#### 五、面试考察点
##### **高频问题**​
1. `​OkHttp` 的拦截器机制？​**​
    - 答：责任链模式，按顺序执行拦截器（如重试、缓存、网络拦截器）。
2. ​**连接池如何复用 `TCP` 连接？​**​
    - 答：同一主机的请求复用同一 Socket，减少握手开销。
3. ​**缓存失效的场景？​**​
    - 答：请求头含 `Cache-Control: no-cache` 或响应头无缓存标识。
  4.` OkHttp` 如何处理文件上传？​**​
    - 答：使用 `MultipartBody` 构建多部分请求体。
##### **源码解析**​
- ​**Dispatcher**​：管理异步任务队列，控制并发数。
- ​`RealCall`​：实际执行请求的类，通过 `getResponseWithInterceptorChain()` 触发拦截器链。
#### 六、适用场景与替代方案
- **适用场景**​：
    - 需要高效网络请求的 Android 应用（如社交、电商）。
    - 需与 Retrofit 集成实现 RESTful API 调用。
- ​**替代方案**​：
    - ​**Volley**​：适合轻量级请求，但不支持同步调用。
    - ​**Retrofit**​：基于 `OkHttp` 封装，适合 `RESTful` 接口。