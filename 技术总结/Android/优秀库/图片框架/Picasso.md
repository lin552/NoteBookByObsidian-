---
创建时间: 2025-04-24 17:25:33
作者: wangxiaoming
tags:
  - Picasso
  - 图片框架
---
#### 一、Picasso概述
- ​**定义**​：  
    Picasso 是 Square 公司开源的 ​**Android 图片加载框架**，专注于轻量级、高性能的图片加载与缓存，以简洁的 API 和高效的内存管理著称。
- ​**核心优势**​：
    - ​**轻量级**​：APK 体积仅约 120KB，适合对包体敏感的项目
    - ​**自动内存管理**​：两级内存缓存（LruCache） + 磁盘缓存（DiskLruCache），减少 OOM 风险
    - ​**链式调用**​：简洁的 API 设计，代码量少（如 `Picasso.with().load().into()`）。
    - ​**图片变换**​：支持圆角、圆形裁剪、缩放等基础操作（需依赖第三方库扩展复杂变换）

#### 2）核心功能与使用
##### 1）基本用法
todo

##### 2）高级用法
todo

#### 三、原理与机制
##### 1）核心机制
1. ​**请求创建**​：通过 `Picasso.get().load()` 生成 `RequestCreator`。
2. ​**请求分发**​：`Dispatcher` 管理请求队列，分配至线程池执行。
3. ​**数据获取**​：从内存/磁盘缓存读取，未命中则触发网络请求（默认使用 `OkHttp`）。
4. ​**解码与渲染**​：将图片数据解码为 Bitmap，应用变换后提交至 `UI` 线程渲染。
##### 2）关键设计
- ​**单例模式**​：全局唯一实例，通过 `Picasso.get()` 获取
- ​**线程模型**​：
    - ​**主线程**​：处理 `UI` 渲染与用户交互。
    - ​**工作线程池**​：默认 4 个线程（根据网络状态动态调整）。
- ​**缓存策略**​：
    - ​**内存缓存**​：占用应用内存的 15%，采用 `LRU` 淘汰机制
    - ​**磁盘缓存**​：默认 `50MB`，基于 `DiskLruCache` 实现

#### 四、优化策略
##### 1）性能优化
- **图片采样率**​：通过 `resize()` 缩小尺寸，减少内存占用。
- ​**压缩格式**​：使用 `WebP` 替代 `JPEG/PNG`，降低包体体积。
- ​**预加载**​：提前加载高频图片到缓存。
```kotlin
Picasso.get().load(url).fetch()
```
##### 2）错误处理
​**全局监听**​：通过 `Listener` 统一处理加载失败事件。
```kotlin
Picasso.get().listener { picasso, uri, exception ->
    Log.e("Picasso", "加载失败: ${exception.message}")
}
```
##### 3）弱网优化
- ​**超时设置**​：自定义 `OkHttp` 客户端调整超时时间。
- ​**重试机制**​：通过拦截器实现自动重试逻辑。

#### 五、优缺点分析
|​**优点**​|​**缺点**​|
|---|---|
|轻量级，APK 体积小|功能较少（如不支持 GIF、视频封面）|
|内存管理高效，避免 OOM|复杂图片变换需依赖第三方库|
|链式调用简洁，学习成本低|不支持动态缩放（如 `FitCenter` 需手动计算）|
#### 六、适用场景
1. ​**简单图片加载**​：如电商商品图、用户头像等静态内容。
2. ​**低内存设备**​：适合低端机型或对内存敏感的场景。
3. ​**快速原型开发**​：轻量级框架可快速集成，减少配置成本。

#### 七、对比其他框架
|​**框架**​|​**优势**​|​**劣势**​|
|---|---|---|
|Picasso|体积小，API 简洁|功能有限，不支持 GIF|
|Glide|支持 GIF、视频缩略，内存优化更强|体积较大（约 400KB）|
|Fresco|支持渐进式加载，内存管理更复杂|学习曲线陡峭|
#### 八、面试考察点
1. **Picasso 的缓存机制？​**​
    - 答：两级缓存（内存 + 磁盘），内存用 `LruCache`，磁盘默认 `50MB`。
2. ​**如何实现图片圆角效果？​**​
    - 答：需引入第三方库（如 `picasso-transformations`）并自定义 `Transformation`。
3. ​**Picasso 如何取消请求？​**​
    - 答：通过 `tag()` 标记请求，调用 `cancelTag()` 批量取消。