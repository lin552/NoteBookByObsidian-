---
创建时间: 2025-04-24 11:22:06
作者: wangxiaoming
tags:
  - Glide
  - 图片框架
---
#### 一、Glide概述
- ​**定义**​：  
    Glide 是 Google 开源的 ​**图片加载与缓存库**，专注于高效加载、解码、缓存和显示图片（支持静态图、GIF、视频封面），适用于 Android 平台。
- ​**核心优势**​：
    - ​**简洁 API**​：链式调用，代码量少（如 `Glide.with().load().into()`）
    - ​**智能缓存**​：内存 + 磁盘双缓存，减少重复加载
    - ​**生命周期集成**​：自动绑定 Activity/Fragment 生命周期，避免内存泄漏
    - ​**高性能解码**​：自动压缩图片、异步加载，优化内存占用
    - ​**扩展性**​：支持自定义图片变换（如圆形裁剪）、动画、拦截器等

#### 二、核心功能与使用
##### 基本用法
```kotlin
todo
```

#### 三、原理与机制
##### 1）加载流程
1. **请求创建**​：`Glide.with(context).load(url)` 生成 `RequestBuilder`。
2. ​**缓存检查**​：
    - ​**内存缓存**​：优先检查 `LRU` 缓存（`LruResourceCache`）
    - ​**磁盘缓存**​：按 `DiskCacheStrategy` 策略检查（如 `AUTOMATIC`、`NONE`）
3. ​**数据获取**​：若缓存未命中，从网络/本地加载原始数据。
4. ​**解码与变换**​：`DecodeJob` 解码为 Bitmap，应用变换（如裁剪、缩放）。
5. ​**资源回收**​：通过 `BitmapPool` 复用 Bitmap，减少内存分配

##### 2）缓存策略
- ​**内存缓存**​：
    - ​**活动资源缓存**​：当前显示的图片（`ActiveResources`）。
    - ​**非活动资源缓存**​：`LRU` 淘汰机制（`MemoryCache`）
- ​**磁盘缓存**​：
    - ​**资源类型**​：原始数据（`RESOURCE`）或变换后的数据（`DATA`）
    - ​**策略控制**​：通过 `diskCacheStrategy()` 设置（如 `DiskCacheStrategy.NONE` 跳过磁盘缓存）。

##### 3）生命周期管理
- ​**自动绑定**​：`Glide.with(Activity/Fragment)` 监听生命周期，自动取消后台请求
- ​**手动控制**​：通过 `clear()` 或 `pauseRequests()` 管理请求。

#### 四、优化策略
##### 1）性能优化
###### 图片压缩：
```kotlin

```
###### 预加载
提前加载图片到缓存
```kotlin

```
###### 线程池配置
调整 `DiskCacheExecutor` 和 `SourceExecutor` 线程数。

##### 2）内存优化
- ​**Bitmap 复用**​：通过 `BitmapPool` 减少 `GC` 压力。
- ​**弱引用持有**​：避免 Context 泄漏（如使用 `Application` Context）。
- ​**禁用动画**​：对不需要动画的场景关闭过渡效果。

##### 3）网络优化
- ​**优先级控制**​：通过 `Priority.HIGH` 提升关键图片加载优先级。
- ​**分块加载**​：对超大图使用 `DiskCacheStrategy.DATA` 仅缓存原始数据。

#### 五、常见问题与解决方案
|​**问题**​|​**原因**​|​**解决方案**​|
|---|---|---|
|​**图片错位**​|列表快速滑动时请求未完成|启用 `thumbnail()` 缩略图，绑定生命周期|
|​**内存泄漏**​|未正确释放请求|使用 `Glide.clear(imageView)`|
|​**加载缓慢**​|未启用缓存或网络差|检查缓存策略，优化网络请求|
|​**GIF 卡顿**​|未启用硬件加速|添加 `android:hardwareAccelerated="true"`|

#### 六、适用场景与替代方案
- ​**适用场景**​：
    - 社交/电商：大量图片加载（如商品列表、朋友圈）。
    - 动态内容：GIF、视频封面展示。
    - 复杂变换：圆角、模糊、裁剪等需求。
- ​**替代方案**​：
    - ​**Picasso**​：更轻量，但功能较少。
    - ​**Fresco**​：强项在内存管理（如渐进式 JPEG），但体积较大。
    - ​**Coil**​：基于 Kotlin 协程，适合现代架构。

#### 七、面试考察点
1. ​**Glide 的缓存机制？​**​
    - 答：双缓存（内存 + 磁盘），内存用 `LRU`，磁盘策略可配置（如 `DiskCacheStrategy.ALL`）
2. ​**如何避免图片错位？​**​
    - 答：绑定生命周期，使用 `thumbnail()` 缩略图，避免异步加载错乱。
3. ​**Glide 如何处理 GIF？​**​
    - 答：通过 `asGif()` 加载，内部使用 `GifDrawable` 控制帧率。
4. ​**自定义图片变换的步骤？​**​
    - 答：继承 `Transformation`，重写 `transform()` 方法，注册到 Glide 模块。